{"version":3,"sources":["assets/Script/View/CellView.js"],"names":["cc","Class","Component","properties","defaultFrame","type","SpriteFrame","onLoad","isSelect","initWithModel","model","x","startX","y","startY","node","CELL_WIDTH","CELL_HEIGHT","animation","getComponent","Animation","status","CELL_STATUS","COMMON","stop","play","updateView","cmd","length","actionArray","curTime","i","playTime","delay","delayTime","push","action","pos","move","moveTo","ANITIME","TOUCH_MOVE","v2","BIRD","BOMB_BIRD_DELAY","callFunc","destroy","isVisible","opacity","rotateRight","rotateBy","rotateLeft","repeat","sequence","keepTime","runAction","setSelect","flag","bg","getChildByName","Sprite","spriteFrame","CLICK","active"],"mappings":"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","sourceRoot":"/","sourcesContent":["import {CELL_STATUS, CELL_WIDTH, CELL_HEIGHT, ANITIME} from '../Model/ConstValue';\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,      // The default value will be used only when the component attaching\n        //                           to a node for the first time\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        defaultFrame:{\n            default: null,\n            type: cc.SpriteFrame\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        //this.model = null;\n        this.isSelect = false;\n    },\n    initWithModel: function(model){\n        this.model = model;\n        var x = model.startX;\n        var y = model.startY;\n        this.node.x = CELL_WIDTH * (x - 0.5);\n        this.node.y = CELL_HEIGHT * (y - 0.5);\n        var animation  = this.node.getComponent(cc.Animation);\n        if (model.status == CELL_STATUS.COMMON){\n            animation.stop();\n        } \n        else{\n            animation.play(model.status);\n        }\n    },\n    // 执行移动动作\n    updateView: function(){\n        var cmd = this.model.cmd;\n        if(cmd.length <= 0){\n            return ;\n        }\n        var actionArray = [];\n        var curTime = 0;\n        for(var i in cmd){\n            if( cmd[i].playTime > curTime){\n                var delay = cc.delayTime(cmd[i].playTime - curTime);\n                actionArray.push(delay);\n            }\n            if(cmd[i].action == \"moveTo\"){\n                var x = (cmd[i].pos.x - 0.5) * CELL_WIDTH;\n                var y = (cmd[i].pos.y - 0.5) * CELL_HEIGHT;\n                var move = cc.moveTo(ANITIME.TOUCH_MOVE, cc.v2(x,y));\n                actionArray.push(move);\n            }\n            else if(cmd[i].action == \"toDie\"){\n                if(this.status == CELL_STATUS.BIRD){\n                    let animation = this.node.getComponent(cc.Animation);\n                    animation.play(\"effect\");\n                    actionArray.push(cc.delayTime(ANITIME.BOMB_BIRD_DELAY));\n                }\n                var callFunc = cc.callFunc(function(){\n                    this.node.destroy();\n                },this);\n                actionArray.push(callFunc);\n            }\n            else if(cmd[i].action == \"setVisible\"){\n                let isVisible = cmd[i].isVisible;\n                actionArray.push(cc.callFunc(function(){\n                    if(isVisible){\n                        this.node.opacity = 255;\n                    }\n                    else{\n                        this.node.opacity = 0;\n                    }\n                },this));\n            }\n            else if(cmd[i].action == \"toShake\"){\n                let rotateRight = cc.rotateBy(0.06,30);\n                let rotateLeft = cc.rotateBy(0.12, -60);\n                actionArray.push(cc.repeat(cc.sequence(rotateRight, rotateLeft, rotateRight), 2));\n            }\n            curTime = cmd[i].playTime + cmd[i].keepTime;\n        }\n        /**\n         * 智障的引擎设计，一群SB\n         */\n        if(actionArray.length == 1){\n            this.node.runAction(actionArray[0]);\n        }\n        else{\n            this.node.runAction(cc.sequence(...actionArray));\n        }\n\n    },\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n    setSelect: function(flag){\n        var animation = this.node.getComponent(cc.Animation);\n        var bg = this.node.getChildByName(\"select\");\n        if(flag == false && this.isSelect && this.model.status == CELL_STATUS.COMMON){\n            animation.stop();\n            this.node.getComponent(cc.Sprite).spriteFrame = this.defaultFrame;\n        }\n        else if(flag && this.model.status == CELL_STATUS.COMMON){\n            animation.play(CELL_STATUS.CLICK);\n        }\n        else if(flag && this.model.status == CELL_STATUS.BIRD){\n            animation.play(CELL_STATUS.CLICK);\n        }\n        bg.active = flag; \n        this.isSelect = flag;\n    }\n});\n"]}
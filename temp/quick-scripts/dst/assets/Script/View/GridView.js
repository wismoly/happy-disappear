
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/View/GridView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd0d1fDj9rlDx5QUtP+2toQV', 'GridView');
// Script/View/GridView.js

"use strict";

var _ConstValue = require("../Model/ConstValue");

var _AudioUtils = _interopRequireDefault(require("../Utils/AudioUtils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //    default: null,      // The default value will be used only when the component attaching
    //                           to a node for the first time
    //    url: cc.Texture2D,  // optional, default is typeof default
    //    serializable: true, // optional, default is true
    //    visible: true,      // optional, default is true
    //    displayName: 'Foo', // optional
    //    readonly: false,    // optional, default is false
    // },
    // ...
    aniPre: {
      "default": [],
      type: [cc.Prefab]
    },
    effectLayer: {
      "default": null,
      type: cc.Node
    },
    audioUtils: {
      type: _AudioUtils["default"],
      "default": null
    }
  },
  // use this for initialization
  onLoad: function onLoad() {
    this.setListener();
    this.lastTouchPos = cc.Vec2(-1, -1);
    this.isCanMove = true;
    this.isInPlayAni = false; // 是否在播放中
  },
  setController: function setController(controller) {
    this.controller = controller;
  },
  initWithCellModels: function initWithCellModels(cellsModels) {
    this.cellViews = [];

    for (var i = 1; i <= 9; i++) {
      this.cellViews[i] = [];

      for (var j = 1; j <= 9; j++) {
        var type = cellsModels[i][j].type;
        var aniView = cc.instantiate(this.aniPre[type]);
        aniView.parent = this.node;
        var cellViewScript = aniView.getComponent("CellView");
        cellViewScript.initWithModel(cellsModels[i][j]);
        this.cellViews[i][j] = aniView;
      }
    }
  },
  setListener: function setListener() {
    this.node.on(cc.Node.EventType.TOUCH_START, function (eventTouch) {
      if (this.isInPlayAni) {
        //播放动画中，不允许点击
        return true;
      }

      var touchPos = eventTouch.getLocation();
      var cellPos = this.convertTouchPosToCell(touchPos);

      if (cellPos) {
        var changeModels = this.selectCell(cellPos);
        this.isCanMove = changeModels.length < 3;
      } else {
        this.isCanMove = false;
      }

      return true;
    }, this); // 滑动操作逻辑

    this.node.on(cc.Node.EventType.TOUCH_MOVE, function (eventTouch) {
      if (this.isCanMove) {
        var startTouchPos = eventTouch.getStartLocation();
        var startCellPos = this.convertTouchPosToCell(startTouchPos);
        var touchPos = eventTouch.getLocation();
        var cellPos = this.convertTouchPosToCell(touchPos);

        if (startCellPos.x != cellPos.x || startCellPos.y != cellPos.y) {
          this.isCanMove = false;
          var changeModels = this.selectCell(cellPos);
        }
      }
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_END, function (eventTouch) {// console.log("1111");
    }, this);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (eventTouch) {// console.log("1111");
    }, this);
  },
  // 根据点击的像素位置，转换成网格中的位置
  convertTouchPosToCell: function convertTouchPosToCell(pos) {
    pos = this.node.convertToNodeSpace(pos);

    if (pos.x < 0 || pos.x >= _ConstValue.GRID_PIXEL_WIDTH || pos.y < 0 || pos.y >= _ConstValue.GRID_PIXEL_HEIGHT) {
      return false;
    }

    var x = Math.floor(pos.x / _ConstValue.CELL_WIDTH) + 1;
    var y = Math.floor(pos.y / _ConstValue.CELL_HEIGHT) + 1;
    return cc.v2(x, y);
  },
  // 移动格子
  updateView: function updateView(changeModels) {
    var newCellViewInfo = [];

    for (var i in changeModels) {
      var model = changeModels[i];
      var viewInfo = this.findViewByModel(model);
      var view = null; // 如果原来的cell不存在，则新建

      if (!viewInfo) {
        var type = model.type;
        var aniView = cc.instantiate(this.aniPre[type]);
        aniView.parent = this.node;
        var cellViewScript = aniView.getComponent("CellView");
        cellViewScript.initWithModel(model);
        view = aniView;
      } // 如果已经存在
      else {
          view = viewInfo.view;
          this.cellViews[viewInfo.y][viewInfo.x] = null;
        }

      var cellScript = view.getComponent("CellView");
      cellScript.updateView(); // 执行移动动作

      if (!model.isDeath) {
        newCellViewInfo.push({
          model: model,
          view: view
        });
      }
    } // 重新标记this.cellviews的信息


    newCellViewInfo.forEach(function (ele) {
      var model = ele.model;
      this.cellViews[model.y][model.x] = ele.view;
    }, this);
  },
  // 显示选中的格子背景
  updateSelect: function updateSelect(pos) {
    for (var i = 1; i <= 9; i++) {
      for (var j = 1; j <= 9; j++) {
        if (this.cellViews[i][j]) {
          var cellScript = this.cellViews[i][j].getComponent("CellView");

          if (pos.x == j && pos.y == i) {
            cellScript.setSelect(true);
          } else {
            cellScript.setSelect(false);
          }
        }
      }
    }
  },

  /**
   * 根据cell的model返回对应的view
   */
  findViewByModel: function findViewByModel(model) {
    for (var i = 1; i <= 9; i++) {
      for (var j = 1; j <= 9; j++) {
        if (this.cellViews[i][j] && this.cellViews[i][j].getComponent("CellView").model == model) {
          return {
            view: this.cellViews[i][j],
            x: j,
            y: i
          };
        }
      }
    }

    return null;
  },
  getPlayAniTime: function getPlayAniTime(changeModels) {
    if (!changeModels) {
      return 0;
    }

    var maxTime = 0;
    changeModels.forEach(function (ele) {
      ele.cmd.forEach(function (cmd) {
        if (maxTime < cmd.playTime + cmd.keepTime) {
          maxTime = cmd.playTime + cmd.keepTime;
        }
      }, this);
    }, this);
    return maxTime;
  },
  // 获得爆炸次数， 同一个时间算一个
  getStep: function getStep(effectsQueue) {
    if (!effectsQueue) {
      return 0;
    }

    return effectsQueue.reduce(function (maxValue, efffectCmd) {
      return Math.max(maxValue, efffectCmd.step || 0);
    }, 0);
  },
  //一段时间内禁止操作
  disableTouch: function disableTouch(time, step) {
    if (time <= 0) {
      return;
    }

    this.isInPlayAni = true;
    this.node.runAction(cc.sequence(cc.delayTime(time), cc.callFunc(function () {
      this.isInPlayAni = false;
      this.audioUtils.playContinuousMatch(step);
    }, this)));
  },
  // 正常击中格子后的操作
  selectCell: function selectCell(cellPos) {
    var result = this.controller.selectCell(cellPos); // 直接先丢给model处理数据逻辑

    var changeModels = result[0]; // 有改变的cell，包含新生成的cell和生成马上摧毁的格子

    var effectsQueue = result[1]; //各种特效

    this.playEffect(effectsQueue);
    this.disableTouch(this.getPlayAniTime(changeModels), this.getStep(effectsQueue));
    this.updateView(changeModels);
    this.controller.cleanCmd();

    if (changeModels.length >= 2) {
      this.updateSelect(cc.v2(-1, -1));
      this.audioUtils.playSwap();
    } else {
      this.updateSelect(cellPos);
      this.audioUtils.playClick();
    }

    return changeModels;
  },
  playEffect: function playEffect(effectsQueue) {
    this.effectLayer.getComponent("EffectLayer").playEffects(effectsQueue);
  } // called every frame, uncomment this function to activate update callback
  // update: function (dt) {
  // },

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVmlldy9HcmlkVmlldy5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImFuaVByZSIsInR5cGUiLCJQcmVmYWIiLCJlZmZlY3RMYXllciIsIk5vZGUiLCJhdWRpb1V0aWxzIiwiQXVkaW9VdGlscyIsIm9uTG9hZCIsInNldExpc3RlbmVyIiwibGFzdFRvdWNoUG9zIiwiVmVjMiIsImlzQ2FuTW92ZSIsImlzSW5QbGF5QW5pIiwic2V0Q29udHJvbGxlciIsImNvbnRyb2xsZXIiLCJpbml0V2l0aENlbGxNb2RlbHMiLCJjZWxsc01vZGVscyIsImNlbGxWaWV3cyIsImkiLCJqIiwiYW5pVmlldyIsImluc3RhbnRpYXRlIiwicGFyZW50Iiwibm9kZSIsImNlbGxWaWV3U2NyaXB0IiwiZ2V0Q29tcG9uZW50IiwiaW5pdFdpdGhNb2RlbCIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJldmVudFRvdWNoIiwidG91Y2hQb3MiLCJnZXRMb2NhdGlvbiIsImNlbGxQb3MiLCJjb252ZXJ0VG91Y2hQb3NUb0NlbGwiLCJjaGFuZ2VNb2RlbHMiLCJzZWxlY3RDZWxsIiwibGVuZ3RoIiwiVE9VQ0hfTU9WRSIsInN0YXJ0VG91Y2hQb3MiLCJnZXRTdGFydExvY2F0aW9uIiwic3RhcnRDZWxsUG9zIiwieCIsInkiLCJUT1VDSF9FTkQiLCJUT1VDSF9DQU5DRUwiLCJwb3MiLCJjb252ZXJ0VG9Ob2RlU3BhY2UiLCJHUklEX1BJWEVMX1dJRFRIIiwiR1JJRF9QSVhFTF9IRUlHSFQiLCJNYXRoIiwiZmxvb3IiLCJDRUxMX1dJRFRIIiwiQ0VMTF9IRUlHSFQiLCJ2MiIsInVwZGF0ZVZpZXciLCJuZXdDZWxsVmlld0luZm8iLCJtb2RlbCIsInZpZXdJbmZvIiwiZmluZFZpZXdCeU1vZGVsIiwidmlldyIsImNlbGxTY3JpcHQiLCJpc0RlYXRoIiwicHVzaCIsImZvckVhY2giLCJlbGUiLCJ1cGRhdGVTZWxlY3QiLCJzZXRTZWxlY3QiLCJnZXRQbGF5QW5pVGltZSIsIm1heFRpbWUiLCJjbWQiLCJwbGF5VGltZSIsImtlZXBUaW1lIiwiZ2V0U3RlcCIsImVmZmVjdHNRdWV1ZSIsInJlZHVjZSIsIm1heFZhbHVlIiwiZWZmZmVjdENtZCIsIm1heCIsInN0ZXAiLCJkaXNhYmxlVG91Y2giLCJ0aW1lIiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJkZWxheVRpbWUiLCJjYWxsRnVuYyIsInBsYXlDb250aW51b3VzTWF0Y2giLCJyZXN1bHQiLCJwbGF5RWZmZWN0IiwiY2xlYW5DbWQiLCJwbGF5U3dhcCIsInBsYXlDbGljayIsInBsYXlFZmZlY3RzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ1AsYUFBU0QsRUFBRSxDQUFDRSxTQURMO0FBR1BDLEVBQUFBLFVBQVUsRUFBRTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FDLElBQUFBLE1BQU0sRUFBRTtBQUNOLGlCQUFTLEVBREg7QUFFTkMsTUFBQUEsSUFBSSxFQUFFLENBQUNMLEVBQUUsQ0FBQ00sTUFBSjtBQUZBLEtBWEU7QUFlVkMsSUFBQUEsV0FBVyxFQUFFO0FBQ1gsaUJBQVMsSUFERTtBQUVYRixNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ1E7QUFGRSxLQWZIO0FBbUJWQyxJQUFBQSxVQUFVLEVBQUU7QUFDVkosTUFBQUEsSUFBSSxFQUFFSyxzQkFESTtBQUVWLGlCQUFTO0FBRkM7QUFuQkYsR0FITDtBQThCUDtBQUNBQyxFQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDbEIsU0FBS0MsV0FBTDtBQUNBLFNBQUtDLFlBQUwsR0FBb0JiLEVBQUUsQ0FBQ2MsSUFBSCxDQUFRLENBQUMsQ0FBVCxFQUFZLENBQUMsQ0FBYixDQUFwQjtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLQyxXQUFMLEdBQW1CLEtBQW5CLENBSmtCLENBSVE7QUFDM0IsR0FwQ007QUFxQ1BDLEVBQUFBLGFBQWEsRUFBRSx1QkFBVUMsVUFBVixFQUFzQjtBQUNuQyxTQUFLQSxVQUFMLEdBQWtCQSxVQUFsQjtBQUNELEdBdkNNO0FBeUNQQyxFQUFBQSxrQkFBa0IsRUFBRSw0QkFBVUMsV0FBVixFQUF1QjtBQUN6QyxTQUFLQyxTQUFMLEdBQWlCLEVBQWpCOztBQUNBLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsSUFBSSxDQUFyQixFQUF3QkEsQ0FBQyxFQUF6QixFQUE2QjtBQUMzQixXQUFLRCxTQUFMLENBQWVDLENBQWYsSUFBb0IsRUFBcEI7O0FBQ0EsV0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxJQUFJLENBQXJCLEVBQXdCQSxDQUFDLEVBQXpCLEVBQTZCO0FBQzNCLFlBQUlsQixJQUFJLEdBQUdlLFdBQVcsQ0FBQ0UsQ0FBRCxDQUFYLENBQWVDLENBQWYsRUFBa0JsQixJQUE3QjtBQUNBLFlBQUltQixPQUFPLEdBQUd4QixFQUFFLENBQUN5QixXQUFILENBQWUsS0FBS3JCLE1BQUwsQ0FBWUMsSUFBWixDQUFmLENBQWQ7QUFDQW1CLFFBQUFBLE9BQU8sQ0FBQ0UsTUFBUixHQUFpQixLQUFLQyxJQUF0QjtBQUNBLFlBQUlDLGNBQWMsR0FBR0osT0FBTyxDQUFDSyxZQUFSLENBQXFCLFVBQXJCLENBQXJCO0FBQ0FELFFBQUFBLGNBQWMsQ0FBQ0UsYUFBZixDQUE2QlYsV0FBVyxDQUFDRSxDQUFELENBQVgsQ0FBZUMsQ0FBZixDQUE3QjtBQUNBLGFBQUtGLFNBQUwsQ0FBZUMsQ0FBZixFQUFrQkMsQ0FBbEIsSUFBdUJDLE9BQXZCO0FBQ0Q7QUFDRjtBQUNGLEdBdERNO0FBdURQWixFQUFBQSxXQUFXLEVBQUUsdUJBQVk7QUFDdkIsU0FBS2UsSUFBTCxDQUFVSSxFQUFWLENBQWEvQixFQUFFLENBQUNRLElBQUgsQ0FBUXdCLFNBQVIsQ0FBa0JDLFdBQS9CLEVBQTRDLFVBQVVDLFVBQVYsRUFBc0I7QUFDaEUsVUFBSSxLQUFLbEIsV0FBVCxFQUFzQjtBQUFDO0FBQ3JCLGVBQU8sSUFBUDtBQUNEOztBQUNELFVBQUltQixRQUFRLEdBQUdELFVBQVUsQ0FBQ0UsV0FBWCxFQUFmO0FBQ0EsVUFBSUMsT0FBTyxHQUFHLEtBQUtDLHFCQUFMLENBQTJCSCxRQUEzQixDQUFkOztBQUNBLFVBQUlFLE9BQUosRUFBYTtBQUNYLFlBQUlFLFlBQVksR0FBRyxLQUFLQyxVQUFMLENBQWdCSCxPQUFoQixDQUFuQjtBQUNBLGFBQUt0QixTQUFMLEdBQWlCd0IsWUFBWSxDQUFDRSxNQUFiLEdBQXNCLENBQXZDO0FBQ0QsT0FIRCxNQUdPO0FBQ0wsYUFBSzFCLFNBQUwsR0FBaUIsS0FBakI7QUFDRDs7QUFDRCxhQUFPLElBQVA7QUFDRCxLQWJELEVBYUcsSUFiSCxFQUR1QixDQWV2Qjs7QUFDQSxTQUFLWSxJQUFMLENBQVVJLEVBQVYsQ0FBYS9CLEVBQUUsQ0FBQ1EsSUFBSCxDQUFRd0IsU0FBUixDQUFrQlUsVUFBL0IsRUFBMkMsVUFBVVIsVUFBVixFQUFzQjtBQUMvRCxVQUFJLEtBQUtuQixTQUFULEVBQW9CO0FBQ2xCLFlBQUk0QixhQUFhLEdBQUdULFVBQVUsQ0FBQ1UsZ0JBQVgsRUFBcEI7QUFDQSxZQUFJQyxZQUFZLEdBQUcsS0FBS1AscUJBQUwsQ0FBMkJLLGFBQTNCLENBQW5CO0FBQ0EsWUFBSVIsUUFBUSxHQUFHRCxVQUFVLENBQUNFLFdBQVgsRUFBZjtBQUNBLFlBQUlDLE9BQU8sR0FBRyxLQUFLQyxxQkFBTCxDQUEyQkgsUUFBM0IsQ0FBZDs7QUFDQSxZQUFJVSxZQUFZLENBQUNDLENBQWIsSUFBa0JULE9BQU8sQ0FBQ1MsQ0FBMUIsSUFBK0JELFlBQVksQ0FBQ0UsQ0FBYixJQUFrQlYsT0FBTyxDQUFDVSxDQUE3RCxFQUFnRTtBQUM5RCxlQUFLaEMsU0FBTCxHQUFpQixLQUFqQjtBQUNBLGNBQUl3QixZQUFZLEdBQUcsS0FBS0MsVUFBTCxDQUFnQkgsT0FBaEIsQ0FBbkI7QUFDRDtBQUNGO0FBQ0YsS0FYRCxFQVdHLElBWEg7QUFZQSxTQUFLVixJQUFMLENBQVVJLEVBQVYsQ0FBYS9CLEVBQUUsQ0FBQ1EsSUFBSCxDQUFRd0IsU0FBUixDQUFrQmdCLFNBQS9CLEVBQTBDLFVBQVVkLFVBQVYsRUFBc0IsQ0FDOUQ7QUFDRCxLQUZELEVBRUcsSUFGSDtBQUdBLFNBQUtQLElBQUwsQ0FBVUksRUFBVixDQUFhL0IsRUFBRSxDQUFDUSxJQUFILENBQVF3QixTQUFSLENBQWtCaUIsWUFBL0IsRUFBNkMsVUFBVWYsVUFBVixFQUFzQixDQUNqRTtBQUNELEtBRkQsRUFFRyxJQUZIO0FBR0QsR0F6Rk07QUEwRlA7QUFDQUksRUFBQUEscUJBQXFCLEVBQUUsK0JBQVVZLEdBQVYsRUFBZTtBQUNwQ0EsSUFBQUEsR0FBRyxHQUFHLEtBQUt2QixJQUFMLENBQVV3QixrQkFBVixDQUE2QkQsR0FBN0IsQ0FBTjs7QUFDQSxRQUFJQSxHQUFHLENBQUNKLENBQUosR0FBUSxDQUFSLElBQWFJLEdBQUcsQ0FBQ0osQ0FBSixJQUFTTSw0QkFBdEIsSUFBMENGLEdBQUcsQ0FBQ0gsQ0FBSixHQUFRLENBQWxELElBQXVERyxHQUFHLENBQUNILENBQUosSUFBU00sNkJBQXBFLEVBQXVGO0FBQ3JGLGFBQU8sS0FBUDtBQUNEOztBQUNELFFBQUlQLENBQUMsR0FBR1EsSUFBSSxDQUFDQyxLQUFMLENBQVdMLEdBQUcsQ0FBQ0osQ0FBSixHQUFRVSxzQkFBbkIsSUFBaUMsQ0FBekM7QUFDQSxRQUFJVCxDQUFDLEdBQUdPLElBQUksQ0FBQ0MsS0FBTCxDQUFXTCxHQUFHLENBQUNILENBQUosR0FBUVUsdUJBQW5CLElBQWtDLENBQTFDO0FBQ0EsV0FBT3pELEVBQUUsQ0FBQzBELEVBQUgsQ0FBTVosQ0FBTixFQUFTQyxDQUFULENBQVA7QUFDRCxHQW5HTTtBQW9HUDtBQUNBWSxFQUFBQSxVQUFVLEVBQUUsb0JBQVVwQixZQUFWLEVBQXdCO0FBQ2xDLFFBQUlxQixlQUFlLEdBQUcsRUFBdEI7O0FBQ0EsU0FBSyxJQUFJdEMsQ0FBVCxJQUFjaUIsWUFBZCxFQUE0QjtBQUMxQixVQUFJc0IsS0FBSyxHQUFHdEIsWUFBWSxDQUFDakIsQ0FBRCxDQUF4QjtBQUNBLFVBQUl3QyxRQUFRLEdBQUcsS0FBS0MsZUFBTCxDQUFxQkYsS0FBckIsQ0FBZjtBQUNBLFVBQUlHLElBQUksR0FBRyxJQUFYLENBSDBCLENBSTFCOztBQUNBLFVBQUksQ0FBQ0YsUUFBTCxFQUFlO0FBQ2IsWUFBSXpELElBQUksR0FBR3dELEtBQUssQ0FBQ3hELElBQWpCO0FBQ0EsWUFBSW1CLE9BQU8sR0FBR3hCLEVBQUUsQ0FBQ3lCLFdBQUgsQ0FBZSxLQUFLckIsTUFBTCxDQUFZQyxJQUFaLENBQWYsQ0FBZDtBQUNBbUIsUUFBQUEsT0FBTyxDQUFDRSxNQUFSLEdBQWlCLEtBQUtDLElBQXRCO0FBQ0EsWUFBSUMsY0FBYyxHQUFHSixPQUFPLENBQUNLLFlBQVIsQ0FBcUIsVUFBckIsQ0FBckI7QUFDQUQsUUFBQUEsY0FBYyxDQUFDRSxhQUFmLENBQTZCK0IsS0FBN0I7QUFDQUcsUUFBQUEsSUFBSSxHQUFHeEMsT0FBUDtBQUNELE9BUEQsQ0FRQTtBQVJBLFdBU0s7QUFDSHdDLFVBQUFBLElBQUksR0FBR0YsUUFBUSxDQUFDRSxJQUFoQjtBQUNBLGVBQUszQyxTQUFMLENBQWV5QyxRQUFRLENBQUNmLENBQXhCLEVBQTJCZSxRQUFRLENBQUNoQixDQUFwQyxJQUF5QyxJQUF6QztBQUNEOztBQUNELFVBQUltQixVQUFVLEdBQUdELElBQUksQ0FBQ25DLFlBQUwsQ0FBa0IsVUFBbEIsQ0FBakI7QUFDQW9DLE1BQUFBLFVBQVUsQ0FBQ04sVUFBWCxHQW5CMEIsQ0FtQkY7O0FBQ3hCLFVBQUksQ0FBQ0UsS0FBSyxDQUFDSyxPQUFYLEVBQW9CO0FBQ2xCTixRQUFBQSxlQUFlLENBQUNPLElBQWhCLENBQXFCO0FBQ25CTixVQUFBQSxLQUFLLEVBQUVBLEtBRFk7QUFFbkJHLFVBQUFBLElBQUksRUFBRUE7QUFGYSxTQUFyQjtBQUlEO0FBQ0YsS0E1QmlDLENBNkJsQzs7O0FBQ0FKLElBQUFBLGVBQWUsQ0FBQ1EsT0FBaEIsQ0FBd0IsVUFBVUMsR0FBVixFQUFlO0FBQ3JDLFVBQUlSLEtBQUssR0FBR1EsR0FBRyxDQUFDUixLQUFoQjtBQUNBLFdBQUt4QyxTQUFMLENBQWV3QyxLQUFLLENBQUNkLENBQXJCLEVBQXdCYyxLQUFLLENBQUNmLENBQTlCLElBQW1DdUIsR0FBRyxDQUFDTCxJQUF2QztBQUNELEtBSEQsRUFHRyxJQUhIO0FBSUQsR0F2SU07QUF3SVA7QUFDQU0sRUFBQUEsWUFBWSxFQUFFLHNCQUFVcEIsR0FBVixFQUFlO0FBQzNCLFNBQUssSUFBSTVCLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLElBQUksQ0FBckIsRUFBd0JBLENBQUMsRUFBekIsRUFBNkI7QUFDM0IsV0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxJQUFJLENBQXJCLEVBQXdCQSxDQUFDLEVBQXpCLEVBQTZCO0FBQzNCLFlBQUksS0FBS0YsU0FBTCxDQUFlQyxDQUFmLEVBQWtCQyxDQUFsQixDQUFKLEVBQTBCO0FBQ3hCLGNBQUkwQyxVQUFVLEdBQUcsS0FBSzVDLFNBQUwsQ0FBZUMsQ0FBZixFQUFrQkMsQ0FBbEIsRUFBcUJNLFlBQXJCLENBQWtDLFVBQWxDLENBQWpCOztBQUNBLGNBQUlxQixHQUFHLENBQUNKLENBQUosSUFBU3ZCLENBQVQsSUFBYzJCLEdBQUcsQ0FBQ0gsQ0FBSixJQUFTekIsQ0FBM0IsRUFBOEI7QUFDNUIyQyxZQUFBQSxVQUFVLENBQUNNLFNBQVgsQ0FBcUIsSUFBckI7QUFDRCxXQUZELE1BR0s7QUFDSE4sWUFBQUEsVUFBVSxDQUFDTSxTQUFYLENBQXFCLEtBQXJCO0FBQ0Q7QUFFRjtBQUNGO0FBQ0Y7QUFDRixHQXhKTTs7QUF5SlA7OztBQUdBUixFQUFBQSxlQUFlLEVBQUUseUJBQVVGLEtBQVYsRUFBaUI7QUFDaEMsU0FBSyxJQUFJdkMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsSUFBSSxDQUFyQixFQUF3QkEsQ0FBQyxFQUF6QixFQUE2QjtBQUMzQixXQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLElBQUksQ0FBckIsRUFBd0JBLENBQUMsRUFBekIsRUFBNkI7QUFDM0IsWUFBSSxLQUFLRixTQUFMLENBQWVDLENBQWYsRUFBa0JDLENBQWxCLEtBQXdCLEtBQUtGLFNBQUwsQ0FBZUMsQ0FBZixFQUFrQkMsQ0FBbEIsRUFBcUJNLFlBQXJCLENBQWtDLFVBQWxDLEVBQThDZ0MsS0FBOUMsSUFBdURBLEtBQW5GLEVBQTBGO0FBQ3hGLGlCQUFPO0FBQUVHLFlBQUFBLElBQUksRUFBRSxLQUFLM0MsU0FBTCxDQUFlQyxDQUFmLEVBQWtCQyxDQUFsQixDQUFSO0FBQThCdUIsWUFBQUEsQ0FBQyxFQUFFdkIsQ0FBakM7QUFBb0N3QixZQUFBQSxDQUFDLEVBQUV6QjtBQUF2QyxXQUFQO0FBQ0Q7QUFDRjtBQUNGOztBQUNELFdBQU8sSUFBUDtBQUNELEdBcktNO0FBc0tQa0QsRUFBQUEsY0FBYyxFQUFFLHdCQUFVakMsWUFBVixFQUF3QjtBQUN0QyxRQUFJLENBQUNBLFlBQUwsRUFBbUI7QUFDakIsYUFBTyxDQUFQO0FBQ0Q7O0FBQ0QsUUFBSWtDLE9BQU8sR0FBRyxDQUFkO0FBQ0FsQyxJQUFBQSxZQUFZLENBQUM2QixPQUFiLENBQXFCLFVBQVVDLEdBQVYsRUFBZTtBQUNsQ0EsTUFBQUEsR0FBRyxDQUFDSyxHQUFKLENBQVFOLE9BQVIsQ0FBZ0IsVUFBVU0sR0FBVixFQUFlO0FBQzdCLFlBQUlELE9BQU8sR0FBR0MsR0FBRyxDQUFDQyxRQUFKLEdBQWVELEdBQUcsQ0FBQ0UsUUFBakMsRUFBMkM7QUFDekNILFVBQUFBLE9BQU8sR0FBR0MsR0FBRyxDQUFDQyxRQUFKLEdBQWVELEdBQUcsQ0FBQ0UsUUFBN0I7QUFDRDtBQUNGLE9BSkQsRUFJRyxJQUpIO0FBS0QsS0FORCxFQU1HLElBTkg7QUFPQSxXQUFPSCxPQUFQO0FBQ0QsR0FuTE07QUFvTFA7QUFDQUksRUFBQUEsT0FBTyxFQUFFLGlCQUFVQyxZQUFWLEVBQXdCO0FBQy9CLFFBQUksQ0FBQ0EsWUFBTCxFQUFtQjtBQUNqQixhQUFPLENBQVA7QUFDRDs7QUFDRCxXQUFPQSxZQUFZLENBQUNDLE1BQWIsQ0FBb0IsVUFBVUMsUUFBVixFQUFvQkMsVUFBcEIsRUFBZ0M7QUFDekQsYUFBTzNCLElBQUksQ0FBQzRCLEdBQUwsQ0FBU0YsUUFBVCxFQUFtQkMsVUFBVSxDQUFDRSxJQUFYLElBQW1CLENBQXRDLENBQVA7QUFDRCxLQUZNLEVBRUosQ0FGSSxDQUFQO0FBR0QsR0E1TE07QUE2TFA7QUFDQUMsRUFBQUEsWUFBWSxFQUFFLHNCQUFVQyxJQUFWLEVBQWdCRixJQUFoQixFQUFzQjtBQUNsQyxRQUFJRSxJQUFJLElBQUksQ0FBWixFQUFlO0FBQ2I7QUFDRDs7QUFDRCxTQUFLckUsV0FBTCxHQUFtQixJQUFuQjtBQUNBLFNBQUtXLElBQUwsQ0FBVTJELFNBQVYsQ0FBb0J0RixFQUFFLENBQUN1RixRQUFILENBQVl2RixFQUFFLENBQUN3RixTQUFILENBQWFILElBQWIsQ0FBWixFQUFnQ3JGLEVBQUUsQ0FBQ3lGLFFBQUgsQ0FBWSxZQUFZO0FBQzFFLFdBQUt6RSxXQUFMLEdBQW1CLEtBQW5CO0FBQ0EsV0FBS1AsVUFBTCxDQUFnQmlGLG1CQUFoQixDQUFvQ1AsSUFBcEM7QUFDRCxLQUhtRCxFQUdqRCxJQUhpRCxDQUFoQyxDQUFwQjtBQUlELEdBdk1NO0FBd01QO0FBQ0EzQyxFQUFBQSxVQUFVLEVBQUUsb0JBQVVILE9BQVYsRUFBbUI7QUFDN0IsUUFBSXNELE1BQU0sR0FBRyxLQUFLekUsVUFBTCxDQUFnQnNCLFVBQWhCLENBQTJCSCxPQUEzQixDQUFiLENBRDZCLENBQ3FCOztBQUNsRCxRQUFJRSxZQUFZLEdBQUdvRCxNQUFNLENBQUMsQ0FBRCxDQUF6QixDQUY2QixDQUVDOztBQUM5QixRQUFJYixZQUFZLEdBQUdhLE1BQU0sQ0FBQyxDQUFELENBQXpCLENBSDZCLENBR0M7O0FBQzlCLFNBQUtDLFVBQUwsQ0FBZ0JkLFlBQWhCO0FBQ0EsU0FBS00sWUFBTCxDQUFrQixLQUFLWixjQUFMLENBQW9CakMsWUFBcEIsQ0FBbEIsRUFBcUQsS0FBS3NDLE9BQUwsQ0FBYUMsWUFBYixDQUFyRDtBQUNBLFNBQUtuQixVQUFMLENBQWdCcEIsWUFBaEI7QUFDQSxTQUFLckIsVUFBTCxDQUFnQjJFLFFBQWhCOztBQUNBLFFBQUl0RCxZQUFZLENBQUNFLE1BQWIsSUFBdUIsQ0FBM0IsRUFBOEI7QUFDNUIsV0FBSzZCLFlBQUwsQ0FBa0J0RSxFQUFFLENBQUMwRCxFQUFILENBQU0sQ0FBQyxDQUFQLEVBQVUsQ0FBQyxDQUFYLENBQWxCO0FBQ0EsV0FBS2pELFVBQUwsQ0FBZ0JxRixRQUFoQjtBQUNELEtBSEQsTUFHTztBQUNMLFdBQUt4QixZQUFMLENBQWtCakMsT0FBbEI7QUFDQSxXQUFLNUIsVUFBTCxDQUFnQnNGLFNBQWhCO0FBQ0Q7O0FBQ0QsV0FBT3hELFlBQVA7QUFDRCxHQXpOTTtBQTBOUHFELEVBQUFBLFVBQVUsRUFBRSxvQkFBVWQsWUFBVixFQUF3QjtBQUNsQyxTQUFLdkUsV0FBTCxDQUFpQnNCLFlBQWpCLENBQThCLGFBQTlCLEVBQTZDbUUsV0FBN0MsQ0FBeURsQixZQUF6RDtBQUNELEdBNU5NLENBaU9QO0FBQ0E7QUFFQTs7QUFwT08sQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ0VMTF9XSURUSCwgQ0VMTF9IRUlHSFQsIEdSSURfUElYRUxfV0lEVEgsIEdSSURfUElYRUxfSEVJR0hULCBBTklUSU1FIH0gZnJvbSAnLi4vTW9kZWwvQ29uc3RWYWx1ZSc7XG5cbmltcG9ydCBBdWRpb1V0aWxzIGZyb20gXCIuLi9VdGlscy9BdWRpb1V0aWxzXCI7XG5cbmNjLkNsYXNzKHtcbiAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gIHByb3BlcnRpZXM6IHtcbiAgICAvLyBmb286IHtcbiAgICAvLyAgICBkZWZhdWx0OiBudWxsLCAgICAgIC8vIFRoZSBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgdXNlZCBvbmx5IHdoZW4gdGhlIGNvbXBvbmVudCBhdHRhY2hpbmdcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIGEgbm9kZSBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAvLyAgICB1cmw6IGNjLlRleHR1cmUyRCwgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHR5cGVvZiBkZWZhdWx0XG4gICAgLy8gICAgc2VyaWFsaXphYmxlOiB0cnVlLCAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXG4gICAgLy8gICAgdmlzaWJsZTogdHJ1ZSwgICAgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXG4gICAgLy8gICAgZGlzcGxheU5hbWU6ICdGb28nLCAvLyBvcHRpb25hbFxuICAgIC8vICAgIHJlYWRvbmx5OiBmYWxzZSwgICAgLy8gb3B0aW9uYWwsIGRlZmF1bHQgaXMgZmFsc2VcbiAgICAvLyB9LFxuICAgIC8vIC4uLlxuICAgIGFuaVByZToge1xuICAgICAgZGVmYXVsdDogW10sXG4gICAgICB0eXBlOiBbY2MuUHJlZmFiXVxuICAgIH0sXG4gICAgZWZmZWN0TGF5ZXI6IHtcbiAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICB0eXBlOiBjYy5Ob2RlXG4gICAgfSxcbiAgICBhdWRpb1V0aWxzOiB7XG4gICAgICB0eXBlOiBBdWRpb1V0aWxzLFxuICAgICAgZGVmYXVsdDogbnVsbFxuICAgIH1cblxuICB9LFxuXG5cbiAgLy8gdXNlIHRoaXMgZm9yIGluaXRpYWxpemF0aW9uXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0TGlzdGVuZXIoKTtcbiAgICB0aGlzLmxhc3RUb3VjaFBvcyA9IGNjLlZlYzIoLTEsIC0xKTtcbiAgICB0aGlzLmlzQ2FuTW92ZSA9IHRydWU7XG4gICAgdGhpcy5pc0luUGxheUFuaSA9IGZhbHNlOyAvLyDmmK/lkKblnKjmkq3mlL7kuK1cbiAgfSxcbiAgc2V0Q29udHJvbGxlcjogZnVuY3Rpb24gKGNvbnRyb2xsZXIpIHtcbiAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xuICB9LFxuXG4gIGluaXRXaXRoQ2VsbE1vZGVsczogZnVuY3Rpb24gKGNlbGxzTW9kZWxzKSB7XG4gICAgdGhpcy5jZWxsVmlld3MgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSA5OyBpKyspIHtcbiAgICAgIHRoaXMuY2VsbFZpZXdzW2ldID0gW107XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8PSA5OyBqKyspIHtcbiAgICAgICAgdmFyIHR5cGUgPSBjZWxsc01vZGVsc1tpXVtqXS50eXBlO1xuICAgICAgICB2YXIgYW5pVmlldyA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYW5pUHJlW3R5cGVdKTtcbiAgICAgICAgYW5pVmlldy5wYXJlbnQgPSB0aGlzLm5vZGU7XG4gICAgICAgIHZhciBjZWxsVmlld1NjcmlwdCA9IGFuaVZpZXcuZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICAgIGNlbGxWaWV3U2NyaXB0LmluaXRXaXRoTW9kZWwoY2VsbHNNb2RlbHNbaV1bal0pO1xuICAgICAgICB0aGlzLmNlbGxWaWV3c1tpXVtqXSA9IGFuaVZpZXc7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgZnVuY3Rpb24gKGV2ZW50VG91Y2gpIHtcbiAgICAgIGlmICh0aGlzLmlzSW5QbGF5QW5pKSB7Ly/mkq3mlL7liqjnlLvkuK3vvIzkuI3lhYHorrjngrnlh7tcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB2YXIgdG91Y2hQb3MgPSBldmVudFRvdWNoLmdldExvY2F0aW9uKCk7XG4gICAgICB2YXIgY2VsbFBvcyA9IHRoaXMuY29udmVydFRvdWNoUG9zVG9DZWxsKHRvdWNoUG9zKTtcbiAgICAgIGlmIChjZWxsUG9zKSB7XG4gICAgICAgIHZhciBjaGFuZ2VNb2RlbHMgPSB0aGlzLnNlbGVjdENlbGwoY2VsbFBvcyk7XG4gICAgICAgIHRoaXMuaXNDYW5Nb3ZlID0gY2hhbmdlTW9kZWxzLmxlbmd0aCA8IDM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmlzQ2FuTW92ZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSwgdGhpcyk7XG4gICAgLy8g5ruR5Yqo5pON5L2c6YC76L6RXG4gICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIGZ1bmN0aW9uIChldmVudFRvdWNoKSB7XG4gICAgICBpZiAodGhpcy5pc0Nhbk1vdmUpIHtcbiAgICAgICAgdmFyIHN0YXJ0VG91Y2hQb3MgPSBldmVudFRvdWNoLmdldFN0YXJ0TG9jYXRpb24oKTtcbiAgICAgICAgdmFyIHN0YXJ0Q2VsbFBvcyA9IHRoaXMuY29udmVydFRvdWNoUG9zVG9DZWxsKHN0YXJ0VG91Y2hQb3MpO1xuICAgICAgICB2YXIgdG91Y2hQb3MgPSBldmVudFRvdWNoLmdldExvY2F0aW9uKCk7XG4gICAgICAgIHZhciBjZWxsUG9zID0gdGhpcy5jb252ZXJ0VG91Y2hQb3NUb0NlbGwodG91Y2hQb3MpO1xuICAgICAgICBpZiAoc3RhcnRDZWxsUG9zLnggIT0gY2VsbFBvcy54IHx8IHN0YXJ0Q2VsbFBvcy55ICE9IGNlbGxQb3MueSkge1xuICAgICAgICAgIHRoaXMuaXNDYW5Nb3ZlID0gZmFsc2U7XG4gICAgICAgICAgdmFyIGNoYW5nZU1vZGVscyA9IHRoaXMuc2VsZWN0Q2VsbChjZWxsUG9zKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIGZ1bmN0aW9uIChldmVudFRvdWNoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIjExMTFcIik7XG4gICAgfSwgdGhpcyk7XG4gICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgZnVuY3Rpb24gKGV2ZW50VG91Y2gpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiMTExMVwiKTtcbiAgICB9LCB0aGlzKTtcbiAgfSxcbiAgLy8g5qC55o2u54K55Ye755qE5YOP57Sg5L2N572u77yM6L2s5o2i5oiQ572R5qC85Lit55qE5L2N572uXG4gIGNvbnZlcnRUb3VjaFBvc1RvQ2VsbDogZnVuY3Rpb24gKHBvcykge1xuICAgIHBvcyA9IHRoaXMubm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2UocG9zKTtcbiAgICBpZiAocG9zLnggPCAwIHx8IHBvcy54ID49IEdSSURfUElYRUxfV0lEVEggfHwgcG9zLnkgPCAwIHx8IHBvcy55ID49IEdSSURfUElYRUxfSEVJR0hUKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb3MueCAvIENFTExfV0lEVEgpICsgMTtcbiAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9zLnkgLyBDRUxMX0hFSUdIVCkgKyAxO1xuICAgIHJldHVybiBjYy52Mih4LCB5KTtcbiAgfSxcbiAgLy8g56e75Yqo5qC85a2QXG4gIHVwZGF0ZVZpZXc6IGZ1bmN0aW9uIChjaGFuZ2VNb2RlbHMpIHtcbiAgICBsZXQgbmV3Q2VsbFZpZXdJbmZvID0gW107XG4gICAgZm9yICh2YXIgaSBpbiBjaGFuZ2VNb2RlbHMpIHtcbiAgICAgIHZhciBtb2RlbCA9IGNoYW5nZU1vZGVsc1tpXTtcbiAgICAgIHZhciB2aWV3SW5mbyA9IHRoaXMuZmluZFZpZXdCeU1vZGVsKG1vZGVsKTtcbiAgICAgIHZhciB2aWV3ID0gbnVsbDtcbiAgICAgIC8vIOWmguaenOWOn+adpeeahGNlbGzkuI3lrZjlnKjvvIzliJnmlrDlu7pcbiAgICAgIGlmICghdmlld0luZm8pIHtcbiAgICAgICAgdmFyIHR5cGUgPSBtb2RlbC50eXBlO1xuICAgICAgICB2YXIgYW5pVmlldyA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYW5pUHJlW3R5cGVdKTtcbiAgICAgICAgYW5pVmlldy5wYXJlbnQgPSB0aGlzLm5vZGU7XG4gICAgICAgIHZhciBjZWxsVmlld1NjcmlwdCA9IGFuaVZpZXcuZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICAgIGNlbGxWaWV3U2NyaXB0LmluaXRXaXRoTW9kZWwobW9kZWwpO1xuICAgICAgICB2aWV3ID0gYW5pVmlldztcbiAgICAgIH1cbiAgICAgIC8vIOWmguaenOW3sue7j+WtmOWcqFxuICAgICAgZWxzZSB7XG4gICAgICAgIHZpZXcgPSB2aWV3SW5mby52aWV3O1xuICAgICAgICB0aGlzLmNlbGxWaWV3c1t2aWV3SW5mby55XVt2aWV3SW5mby54XSA9IG51bGw7XG4gICAgICB9XG4gICAgICB2YXIgY2VsbFNjcmlwdCA9IHZpZXcuZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICBjZWxsU2NyaXB0LnVwZGF0ZVZpZXcoKTsvLyDmiafooYznp7vliqjliqjkvZxcbiAgICAgIGlmICghbW9kZWwuaXNEZWF0aCkge1xuICAgICAgICBuZXdDZWxsVmlld0luZm8ucHVzaCh7XG4gICAgICAgICAgbW9kZWw6IG1vZGVsLFxuICAgICAgICAgIHZpZXc6IHZpZXdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIOmHjeaWsOagh+iusHRoaXMuY2VsbHZpZXdz55qE5L+h5oGvXG4gICAgbmV3Q2VsbFZpZXdJbmZvLmZvckVhY2goZnVuY3Rpb24gKGVsZSkge1xuICAgICAgbGV0IG1vZGVsID0gZWxlLm1vZGVsO1xuICAgICAgdGhpcy5jZWxsVmlld3NbbW9kZWwueV1bbW9kZWwueF0gPSBlbGUudmlldztcbiAgICB9LCB0aGlzKTtcbiAgfSxcbiAgLy8g5pi+56S66YCJ5Lit55qE5qC85a2Q6IOM5pmvXG4gIHVwZGF0ZVNlbGVjdDogZnVuY3Rpb24gKHBvcykge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IDk7IGkrKykge1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPD0gOTsgaisrKSB7XG4gICAgICAgIGlmICh0aGlzLmNlbGxWaWV3c1tpXVtqXSkge1xuICAgICAgICAgIHZhciBjZWxsU2NyaXB0ID0gdGhpcy5jZWxsVmlld3NbaV1bal0uZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIik7XG4gICAgICAgICAgaWYgKHBvcy54ID09IGogJiYgcG9zLnkgPT0gaSkge1xuICAgICAgICAgICAgY2VsbFNjcmlwdC5zZXRTZWxlY3QodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2VsbFNjcmlwdC5zZXRTZWxlY3QoZmFsc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog5qC55o2uY2VsbOeahG1vZGVs6L+U5Zue5a+55bqU55qEdmlld1xuICAgKi9cbiAgZmluZFZpZXdCeU1vZGVsOiBmdW5jdGlvbiAobW9kZWwpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8PSA5OyBpKyspIHtcbiAgICAgIGZvciAodmFyIGogPSAxOyBqIDw9IDk7IGorKykge1xuICAgICAgICBpZiAodGhpcy5jZWxsVmlld3NbaV1bal0gJiYgdGhpcy5jZWxsVmlld3NbaV1bal0uZ2V0Q29tcG9uZW50KFwiQ2VsbFZpZXdcIikubW9kZWwgPT0gbW9kZWwpIHtcbiAgICAgICAgICByZXR1cm4geyB2aWV3OiB0aGlzLmNlbGxWaWV3c1tpXVtqXSwgeDogaiwgeTogaSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9LFxuICBnZXRQbGF5QW5pVGltZTogZnVuY3Rpb24gKGNoYW5nZU1vZGVscykge1xuICAgIGlmICghY2hhbmdlTW9kZWxzKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgdmFyIG1heFRpbWUgPSAwO1xuICAgIGNoYW5nZU1vZGVscy5mb3JFYWNoKGZ1bmN0aW9uIChlbGUpIHtcbiAgICAgIGVsZS5jbWQuZm9yRWFjaChmdW5jdGlvbiAoY21kKSB7XG4gICAgICAgIGlmIChtYXhUaW1lIDwgY21kLnBsYXlUaW1lICsgY21kLmtlZXBUaW1lKSB7XG4gICAgICAgICAgbWF4VGltZSA9IGNtZC5wbGF5VGltZSArIGNtZC5rZWVwVGltZTtcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcylcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gbWF4VGltZTtcbiAgfSxcbiAgLy8g6I635b6X54iG54K45qyh5pWw77yMIOWQjOS4gOS4quaXtumXtOeul+S4gOS4qlxuICBnZXRTdGVwOiBmdW5jdGlvbiAoZWZmZWN0c1F1ZXVlKSB7XG4gICAgaWYgKCFlZmZlY3RzUXVldWUpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gZWZmZWN0c1F1ZXVlLnJlZHVjZShmdW5jdGlvbiAobWF4VmFsdWUsIGVmZmZlY3RDbWQpIHtcbiAgICAgIHJldHVybiBNYXRoLm1heChtYXhWYWx1ZSwgZWZmZmVjdENtZC5zdGVwIHx8IDApO1xuICAgIH0sIDApO1xuICB9LFxuICAvL+S4gOauteaXtumXtOWGheemgeatouaTjeS9nFxuICBkaXNhYmxlVG91Y2g6IGZ1bmN0aW9uICh0aW1lLCBzdGVwKSB7XG4gICAgaWYgKHRpbWUgPD0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzSW5QbGF5QW5pID0gdHJ1ZTtcbiAgICB0aGlzLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSh0aW1lKSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5pc0luUGxheUFuaSA9IGZhbHNlO1xuICAgICAgdGhpcy5hdWRpb1V0aWxzLnBsYXlDb250aW51b3VzTWF0Y2goc3RlcCk7XG4gICAgfSwgdGhpcykpKTtcbiAgfSxcbiAgLy8g5q2j5bi45Ye75Lit5qC85a2Q5ZCO55qE5pON5L2cXG4gIHNlbGVjdENlbGw6IGZ1bmN0aW9uIChjZWxsUG9zKSB7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMuY29udHJvbGxlci5zZWxlY3RDZWxsKGNlbGxQb3MpOyAvLyDnm7TmjqXlhYjkuKLnu5ltb2RlbOWkhOeQhuaVsOaNrumAu+i+kVxuICAgIHZhciBjaGFuZ2VNb2RlbHMgPSByZXN1bHRbMF07IC8vIOacieaUueWPmOeahGNlbGzvvIzljIXlkKvmlrDnlJ/miJDnmoRjZWxs5ZKM55Sf5oiQ6ams5LiK5pGn5q+B55qE5qC85a2QXG4gICAgdmFyIGVmZmVjdHNRdWV1ZSA9IHJlc3VsdFsxXTsgLy/lkITnp43nibnmlYhcbiAgICB0aGlzLnBsYXlFZmZlY3QoZWZmZWN0c1F1ZXVlKTtcbiAgICB0aGlzLmRpc2FibGVUb3VjaCh0aGlzLmdldFBsYXlBbmlUaW1lKGNoYW5nZU1vZGVscyksIHRoaXMuZ2V0U3RlcChlZmZlY3RzUXVldWUpKTtcbiAgICB0aGlzLnVwZGF0ZVZpZXcoY2hhbmdlTW9kZWxzKTtcbiAgICB0aGlzLmNvbnRyb2xsZXIuY2xlYW5DbWQoKTtcbiAgICBpZiAoY2hhbmdlTW9kZWxzLmxlbmd0aCA+PSAyKSB7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdChjYy52MigtMSwgLTEpKTtcbiAgICAgIHRoaXMuYXVkaW9VdGlscy5wbGF5U3dhcCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdChjZWxsUG9zKTtcbiAgICAgIHRoaXMuYXVkaW9VdGlscy5wbGF5Q2xpY2soKTtcbiAgICB9XG4gICAgcmV0dXJuIGNoYW5nZU1vZGVscztcbiAgfSxcbiAgcGxheUVmZmVjdDogZnVuY3Rpb24gKGVmZmVjdHNRdWV1ZSkge1xuICAgIHRoaXMuZWZmZWN0TGF5ZXIuZ2V0Q29tcG9uZW50KFwiRWZmZWN0TGF5ZXJcIikucGxheUVmZmVjdHMoZWZmZWN0c1F1ZXVlKTtcbiAgfVxuXG5cblxuXG4gIC8vIGNhbGxlZCBldmVyeSBmcmFtZSwgdW5jb21tZW50IHRoaXMgZnVuY3Rpb24gdG8gYWN0aXZhdGUgdXBkYXRlIGNhbGxiYWNrXG4gIC8vIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG5cbiAgLy8gfSxcbn0pO1xuIl19